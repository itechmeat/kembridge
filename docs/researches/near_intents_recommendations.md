# Добавление **NEAR Intents** в KEMBridge

*Версия: 14 июля 2025*  

---

## 1. Зачем KEMBridge нужны NEAR Intents?

| Проблема | Как её решают Intents | Выгода |
|----------|----------------------|--------|
| **Многошаговые кросс‑чейн операции** (депозит → мост → своп → вывод) требуют от пользователя подписывать 2‑4 транзакции в разных сетях. | Один высокоуровневый *Intent* описывает *что* хочет пользователь получить. Исполнитель (KEMBridge + маркет‑мейкеры) выполняет все шаги атомарно либо откатывает. | UX «one‑click»: меньше ошибок, выше конверсия. |
| **Блокировки средств между шагами** → риск недоверенным исполнителям. | Intents контракт на NEAR удерживает залоги обеих сторон и гарантирует атомарность (или возврат). | Снижение контрагенского риска, повышенное доверие со стороны институционалов. |
| **Фронт‑ран и MEV** при раскрытии последовательности транзакций. | Условия сделки хранятся off‑chain, on‑chain публикуется лишь победивший маршрут → ниже шанс фронт‑рана. | Меньше проскальзывания, конкурентные курсы. |
| **Расширение на новые цепочки/DEX‑ы** требует писать кастомное UI для каждой пары. | Intent описывает «from → to» в абстрактном виде; добавление нового маршрута = новый исполнитель без изменений UI. | Быстрее выводить новые сети и источники ликвидности. |

---

## 2. Преимущества для KEMBridge

1. **Ультра‑простой UX** – пользователю достаточно указать *`1 ETH → NEAR (quantum‑safe)`*; всё остальное (Omni Bridge, 1inch, квантовые подписи) исполняется автоматически.  
2. **Атомарность + безопасность** – Intents‑контракт хранит депозиты обеих сторон, поэтому даже при сбое моста средства не застревают.  
3. **Комбинаторика маршрутов** – Risk Engine может конкурировать с внешними маркет‑мейкерами: лучший курс + минимальный риск выигрывают Intents‑аукцион.  
4. **Монетизация** – KEMBridge может взимать *execution fee* за каждый выполненный Intent, не входя в газ‑кошелёк пользователя.  
5. **Совместимость с Chain Signatures** – один NEAR‑аккаунт подписывает мультичейн‑транзакции Intents‑исполнителя, сохраняя централизованный аудит и пост‑квантовую защиту.

---

## 3. Когда внедрять

| Этап | Цель | Риски / «стоимость» |
|------|------|---------------------|
| **Post‑MVP (Beta)** – после запуска Omni/Rainbow Dual‑Bridge и базовых свопов | • Доказать one‑click UX<br>• Собрать первые «интенты» на ETH ↔ NEAR | Средняя сложность: нужен один контракт Intents + off‑chain match‑сервис |
| **Pilot (Mainnet Q4 2025)** | • Поддержка 3–4 цепочек<br>• Пороговая сумма \< 5k USD | Доп. работа: интеграция с Risk Engine, SLA‑метрики |
| **Production 2026** | • Все маршруты KEMBridge через Intents<br>• Liquidity Mining для исполнителей | Высокая нагрузка: масштабирование match‑модулей, арбитражные боты |

> **Рекомендация:** начать с *опционального* «Fast Swap (1‑Click)» режима в бета‑версии. Сохраняем fallback на классический flow, пока Intents не пройдут боевое тестирование.

---

## 4. Сложность внедрения

**Умеренная (≈ 6–8 человеко‑недель)** при существующей Rust/TypeScript‑архитектуре.

### Основные компоненты

| Компонент | Что делать | Оценка трудоёмкости |
|-----------|-----------|---------------------|
| **Intents Smart‑Contract (Rust → Wasm)** | Логика депозитов, аукциона, тайм‑аутов | 2 нед. |
| **Match Engine (svc‑intents)** | Off‑chain служба: слушает новые Intents, считает маршруты (1inch / OpenOcean / собственные), подаёт заявки | 1 нед. |
| **Orchestrator Patch** | Вместо «swap → bridge» вызывать `submit_intent()` и ждать событие `IntentExecuted` | 3 дн. |
| **Risk Engine Hook** | Скoring Intent до подачи заявки, публикация `riskScore` в calldata | 3 дн. |
| **Frontend** | Новая форма «1‑Click Swap», прогресс‑бар, ETA | 1 нед. |
| **DevOps & Monitoring** | Графана: latency, fail‑rate, fill‑rate; алёрты > X мин без матчей | 3 дн. |

### Потенциальные подводные камни

* Сложная логика возврата залога при **частичном исполнении** – стоит начать с *fill‑or‑kill*.  
* Требуется защита от **DoS спама** дешёвых Intents (фронтовой fee = min NEAR 0.05).  
* Если исполнителей мало, могут возникнуть «зависшие» Intents — планировать fallback (откат на классический swap).

---

## 5. Рекомендации и «best practices»

1. **Интерфейс `IIntentExecutor`** – добавьте новый trait рядом с `IBridge`: позволит подменять реализацию, а не хардкодить Intents.  
2. **Telemetry first** – логируйте каждый этап (deposit, match, execute, settle) в Prometheus; это упростит A/B‑тесты UX.  
3. **Security Review** – минимально: audit депозита‑контракта и возврата средств (reentrancy, underflow).  
4. **Пост‑квантовая совместимость** – храните hash( PQ‑pubkey ) в Intent, чтобы позже легко мигрировать на Kyber/Dilithium подписи.  
5. **Liquidity Mining β** – стимулируйте сторонних исполнителей (маркет‑мейкеры, арбитражеры) через `execution_rewards`; это ускорит adoption.

---

## 6. TL;DR

**NEAR Intents превращают KEMBridge из «моста с кнопкой swap» в полно‑функциональную _one‑click конвейерную_ систему:** пользователь заявляет результат, а KEMBridge и рынок находят и исполняют оптимальный маршрут. Внедряйте после стабилизации Dual‑Bridge, сначала как экспериментальный fast‑path. Сложность умеренная, выигрыш в UX и гибкости — значительный.
