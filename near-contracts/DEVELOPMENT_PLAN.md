# KEMBridge NEAR Contract Development Plan

## –¶–µ–ª—å

–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π HelloContract –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π bridge –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ FUNC.md

## –§–ª–æ—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
1. –ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Üí 2. Build ‚Üí 3. Deploy ‚Üí 4. Test ‚Üí 5. –§–∏–∫—Å –±–∞–≥–æ–≤ ‚Üí –ø–æ–≤—Ç–æ—Ä 2-4
```

**–í–ê–ñ–ù–û: –ü–û 1 –ú–ï–¢–û–î–£ –ó–ê –†–ê–ó!**

**–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞:**

1. ‚úçÔ∏è –ü–∏—à–µ–º –∫–æ–¥ –û–î–ù–û–ì–û –º–µ—Ç–æ–¥–∞
2. üîç –ò–°–ü–†–ê–í–õ–Ø–ï–ú –í–°–ï –Ø–í–ù–´–ï –û–®–ò–ë–ö–ò –í –ö–û–î–ï (–∏–º–ø–æ—Ä—Ç—ã, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —Ç.–¥.)
3. üî® `make build` - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–ø–∏–ª—è—Ü–∏—é
4. üöÄ `make deploy` - –¥–µ–ø–ª–æ–∏–º –Ω–∞ testnet
5. üß™ –°–æ–∑–¥–∞–µ–º unit-—Ç–µ—Å—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤ `scripts/test-contract.sh`
6. üß™ –ó–∞–ø—É—Å–∫–∞–µ–º `make test` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
7. üêõ –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - —Ñ–∏–∫—Å–∏–º –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Å —à–∞–≥–∞ 3
8. ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–µ—Ç–æ–¥—É

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**

- –õ–Æ–ë–û–ï –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ (–¥–∞–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤) —Ç—Ä–µ–±—É–µ—Ç build + deploy!
- –ù–ï –ú–ï–ù–Ø–¢–¨ –ö–û–î –±–µ–∑ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ build + deploy!
- Build –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ë–ï–ó WARNINGS! –ò—Å–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è!
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –≤ `scripts/test-contract.sh`!

**–ù–ï –î–ï–õ–ê–¢–¨ –°–†–ê–ó–£ –ú–ù–û–ì–û –ú–ï–¢–û–î–û–í!!!**

**–í–ê–ñ–ù–û: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:**

- –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å–æ —Å—Ç–∞—Ä—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–ª–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –Ω–æ–≤–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ
- –ó–∞–ø–∏—Å–∞—Ç—å –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–Ω–µ –∞–∫–∫–∞—É–Ω—Ç)

**–í–ê–ñ–ù–û: –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤ –≤ `scripts/test-contract.sh`:**

- –î–ª—è view –º–µ—Ç–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `run_view_test "Test Name" "command" "expected_pattern"`
- –î–ª—è transaction –º–µ—Ç–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `run_test "Test Name" "command" expected_exit_code`
- –î–æ–±–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç—ã –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≥—Ä—É–ø–ø–∞—Ö (‚ïê‚ïê‚ïê Group Name ‚ïê‚ïê‚ïê)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å `make test` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞

## –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –≠—Ç–∞–ø 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–ó–ê–í–ï–†–®–ï–ù)

- [x] –ü—Ä–æ—Å—Ç–æ–π HelloContract
- [x] Rust 1.86.0 setup
- [x] Build/deploy pipeline

### üîÑ –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¢–ï–ö–£–©–ò–ô)

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**

- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É BridgeContract
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (min/max amounts, fees)
- [ ] –î–æ–±–∞–≤–∏—Ç—å owner/admin —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞—É–∑—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

**–ú–µ—Ç–æ–¥—ã:**

- `new(owner)` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
- `get_config()` - –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- `update_config()` - –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ owner)
- `set_paused()` - –ø–∞—É–∑–∞/—Å–Ω—è—Ç–∏–µ –ø–∞—É–∑—ã (—Ç–æ–ª—å–∫–æ owner)

### üìä –≠—Ç–∞–ø 2: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**

- [ ] –î–æ–±–∞–≤–∏—Ç—å bridge statistics (total locked/unlocked)
- [ ] –î–æ–±–∞–≤–∏—Ç—å view –º–µ—Ç–æ–¥—ã –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ú–µ—Ç–æ–¥—ã:**

- `get_bridge_stats()` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `get_locked_balance(account)` - –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `is_eth_tx_processed(eth_tx_hash)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Ethereum —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### üîí –≠—Ç–∞–ø 3: Lock –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚úÖ

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å lock_tokens —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [x] –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–ª—è lock –æ–ø–µ—Ä–∞—Ü–∏–π
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤ –∏ fees

**–ú–µ—Ç–æ–¥—ã:**

- `lock_tokens(eth_recipient, quantum_hash)` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã ‚úÖ
- –ü—Ä–æ–≤–µ—Ä–∫–∏: minimum amount, maximum amount, fees ‚úÖ (`validate_amount`, `calculate_fee`)
- –°–æ–±—ã—Ç–∏—è: LockEvent ‚úÖ (JSON –ª–æ–≥–∏)

### üîì –≠—Ç–∞–ø 4: Unlock –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚úÖ

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å unlock_tokens
- [x] –î–æ–±–∞–≤–∏—Ç—å replay protection (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ eth_tx_hash)
- [x] –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–ª—è unlock

**–ú–µ—Ç–æ–¥—ã:**

- `unlock_tokens(amount, near_recipient, eth_tx_hash, quantum_hash)` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã ‚úÖ
- Replay protection —á–µ—Ä–µ–∑ IterableSet<String> ‚úÖ (enhanced `processed_eth_txs`)
- –°–æ–±—ã—Ç–∏—è: UnlockEvent ‚úÖ (JSON –ª–æ–≥–∏)
- `mark_eth_tx_processed(eth_tx_hash)` - –ø–æ–º–µ—á–∞—Ç—å ETH —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚úÖ

### ü™ô –≠—Ç–∞–ø 5: Mint/Burn –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚úÖ

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å mint_tokens
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å burn_tokens
- [x] –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å quantum hashes

**–ú–µ—Ç–æ–¥—ã:**

- `mint_tokens(recipient, amount, eth_tx_hash, quantum_hash)` - —Å–æ–∑–¥–∞—Ç—å wrapped —Ç–æ–∫–µ–Ω—ã ‚úÖ
- `burn_tokens(amount, eth_recipient, quantum_hash)` - —Å–∂–µ—á—å wrapped —Ç–æ–∫–µ–Ω—ã ‚úÖ (payable)
- –°–æ–±—ã—Ç–∏—è: `MintEvent`, `BurnEvent` ‚úÖ (JSON –ª–æ–≥–∏)
- Replay protection –¥–ª—è mint –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ

### üõ°Ô∏è –≠—Ç–∞–ø 6: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞–¥–º–∏–Ω–∫–∞ ‚úÖ

**–ß—Ç–æ –¥–µ–ª–∞–µ–º:**

- [x] Emergency withdraw —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [x] Transfer ownership (—É–∂–µ –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- [x] –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ú–µ—Ç–æ–¥—ã:**

- `emergency_withdraw(amount)` - —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ (—Ç–æ–ª—å–∫–æ owner) ‚úÖ
- `transfer_ownership(new_owner)` - –ø–µ—Ä–µ–¥–∞—á–∞ –≤–ª–∞–¥–µ–Ω–∏—è ‚úÖ (—É–∂–µ –±—ã–ª)
- `get_contract_balance()` - –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ ‚úÖ
- `get_total_bridge_volume()` - –æ–±—â–∏–π –æ–±—ä–µ–º bridge –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ
- –°–æ–±—ã—Ç–∏—è: `EmergencyWithdrawEvent` ‚úÖ (JSON –ª–æ–≥–∏)

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

```rust
#[near(contract_state)]
pub struct BridgeContract {
    owner: AccountId,
    paused: bool,
    config: BridgeConfig,
    bridge_stats: BridgeStats,
    user_balances: UnorderedMap<AccountId, Balance>,
    processed_eth_txs: UnorderedSet<String>,
    transactions: Vector<Transaction>,
}

#[derive(BorshSerialize, BorshDeserialize, Serialize, Deserialize)]
pub struct BridgeConfig {
    min_bridge_amount: Balance,
    max_bridge_amount: Balance,
    bridge_fee_bp: u16, // basis points (100 = 1%)
}

#[derive(BorshSerialize, BorshDeserialize, Serialize, Deserialize)]
pub struct BridgeStats {
    total_locked: Balance,
    total_unlocked: Balance,
    total_minted: Balance,
    total_burned: Balance,
}
```

## –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å

- **–≠—Ç–∞–ø 0**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **–≠—Ç–∞–ø 1**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∞–¥–º–∏–Ω–∫–∞)
- **–≠—Ç–∞–ø 2**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä)
- **–≠—Ç–∞–ø 3**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (Lock –æ–ø–µ—Ä–∞—Ü–∏–∏)
- **–≠—Ç–∞–ø 4**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (Unlock –æ–ø–µ—Ä–∞—Ü–∏–∏)
- **–≠—Ç–∞–ø 5**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (Mint/Burn –æ–ø–µ—Ä–∞—Ü–∏–∏)
- **–≠—Ç–∞–ø 6**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω (–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞–¥–º–∏–Ω–∫–∞)

**üéâ –í–°–ï –≠–¢–ê–ü–´ –ó–ê–í–ï–†–®–ï–ù–´! üéâ**

## –ó–∞–º–µ—Ç–∫–∏

- –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –∏ —Ñ–∏–∫—Å–∏–º
- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–±–æ—Ç–∞—é—â—É—é –≤–µ—Ä—Å–∏—é –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
