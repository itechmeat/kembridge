# Phase 6.1: Price Oracle Integration - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üìã –û–±–∑–æ—Ä

Phase 6.1 –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ü–µ–Ω (Chainlink Price Feeds, CoinGecko, Binance API) –≤ KEMBridge –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ–≥–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∫—Ä–æ—Å—Å-—á–µ–π–Ω —Å–≤–æ–ø–∞—Ö. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–µ, –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã —Å –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ fallback –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

## üéØ –¶–µ–ª–∏ Phase 6.1

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Chainlink Price Feeds** - –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ü–µ–Ω
2. **–°–æ–∑–¥–∞–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ü–µ–Ω** - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
3. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ü–µ–Ω** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–°–æ–∑–¥–∞–Ω–∏–µ fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–π** - —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ü–µ–Ω
6. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ü–µ–Ω** - –ø—Ä–æ–≤–µ—Ä–∫–∞ freshness –¥–∞–Ω–Ω—ã—Ö
7. **API endpoints** - HTTP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã ETH/USD –∏ NEAR/USD
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –¶–µ–Ω—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –≤ Redis —Å TTL
- API endpoints –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Ü–µ–Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
backend/src/
‚îú‚îÄ‚îÄ price_oracle/
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs              # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å —Å PriceOracleService
‚îÇ   ‚îú‚îÄ‚îÄ providers/          # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Ü–µ–Ω
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chainlink.rs    # Chainlink Price Feeds
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ coingecko.rs    # CoinGecko API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ binance.rs      # Binance API
‚îÇ   ‚îú‚îÄ‚îÄ aggregator.rs       # –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ü–µ–Ω –æ—Ç —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ validator.rs        # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ cache.rs           # Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ types.rs           # –¢–∏–ø—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ price_oracle.rs    # HTTP handlers
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ price_oracle.rs    # API routes
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω —Å TTL (Time To Live)
- Fallback –∫ –∫–µ—à—É –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- Batching –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 3. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è fallback
```
Primary: Chainlink Price Feeds
Secondary: CoinGecko API
Tertiary: Binance API
Fallback: Redis Cache
Emergency: Static backup prices
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### PriceOracleService
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Ü–µ–Ω
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ fallback –ª–æ–≥–∏–∫–æ–π
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç unified API –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π

#### PriceProvider trait
```rust
#[async_trait]
pub trait PriceProvider {
    async fn get_price(&self, symbol: &str) -> Result<PriceData, PriceError>;
    async fn get_multiple_prices(&self, symbols: &[&str]) -> Result<Vec<PriceData>, PriceError>;
    fn provider_name(&self) -> &str;
    fn is_available(&self) -> bool;
}
```

#### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
```rust
pub struct PriceData {
    pub symbol: String,
    pub price: Decimal,
    pub timestamp: DateTime<Utc>,
    pub source: String,
    pub confidence: f64,
}

pub struct AggregatedPrice {
    pub symbol: String,
    pub price: Decimal,
    pub sources: Vec<String>,
    pub confidence: f64,
    pub last_updated: DateTime<Utc>,
}
```

### 2. Chainlink Integration
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Chainlink Price Feeds –¥–ª—è ETH/USD –∏ NEAR/USD
- –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ contracts —á–µ—Ä–µ–∑ Web3 RPC
- –û–±—Ä–∞–±–æ—Ç–∫–∞ chain-specific –¥–∞–Ω–Ω—ã—Ö

### 3. Redis Caching Strategy
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ü–µ–Ω
- Fallback –∫–µ—à –Ω–∞ 24 —á–∞—Å–∞ –¥–ª—è emergency cases
- –ü—Ä–µ—Ñ–∏–∫—Å—ã –∫–ª—é—á–µ–π: `price:primary:ETH:USD`, `price:fallback:NEAR:USD`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –æ—Ç —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- Blacklist –¥–ª—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- Rate limiting –¥–ª—è API calls

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- Circuit breaker pattern –¥–ª—è failing providers
- Comprehensive logging –≤—Å–µ—Ö —Ü–µ–Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. API Security
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è price endpoints
- Rate limiting –Ω–∞ API routes
- Input validation –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

### 1. Bridge Service
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ exchange rates
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å swap –º–µ—Ö–∞–Ω–∏–∑–º–æ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–π

### 2. Risk Engine
- –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω–æ–≤—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ market manipulation
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI risk scoring

### 3. Monitoring
- WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Ü–µ–Ω
- Dashboard –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è price oracle
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### 1. –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- Latency –∫–∞–∂–¥–æ–≥–æ price provider
- Success rate API calls
- Cache hit/miss ratios
- Price deviation alerts

### 2. Health checks
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ Redis
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ staleness –¥–∞–Ω–Ω—ã—Ö

### 3. Alerting
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ failing providers
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö —Ü–µ–Ω
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ performance degradation

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. Unit Tests
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ price provider
- –ü—Ä–æ–≤–µ—Ä–∫–∞ aggregation –ª–æ–≥–∏–∫–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. Integration Tests
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ workflow
- –ü—Ä–æ–≤–µ—Ä–∫–∞ fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤
- –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. Mock –¥–∞–Ω–Ω—ã–µ
- –°–∏–º—É–ª—è—Ü–∏—è API responses
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ error scenarios
- –ü—Ä–æ–≤–µ—Ä–∫–∞ cache behavior

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- Batching –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ–Ω
- Connection pooling –¥–ª—è HTTP clients

### 2. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- In-memory –∫–µ—à –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö —Ü–µ–Ω
- Redis persistence –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- Smart cache invalidation

### 3. Scalability
- Horizontal scaling —á–µ—Ä–µ–∑ Redis cluster
- Load balancing –¥–ª—è API endpoints
- Async processing –¥–ª—è –≤—Å–µ—Ö operations

## üîÑ Deployment

### 1. Configuration
- Environment variables –¥–ª—è API keys
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ providers —á–µ—Ä–µ–∑ config files
- Docker secrets –¥–ª—è sensitive data

### 2. Monitoring
- Prometheus metrics export
- Grafana dashboards –¥–ª—è price tracking
- Alert manager integration

### 3. Rollback strategy
- Blue-green deployment –¥–ª—è price service
- Fallback –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤–µ—Ä—Å–∏—è–º
- Database migration compatibility

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 6.1:
1. **Phase 6.2: 1inch Fusion+ Integration** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1inch –¥–ª—è optimal routing
2. **Phase 6.3: Dynamic Pricing Logic** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
3. **Phase 7: Frontend Integration** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React UI

## üîó –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

- **BridgeService**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –¥–ª—è exchange rate calculation
- **RiskEngine**: –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω–æ–≤—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π
- **MonitoringService**: Real-time price updates
- **Redis**: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ persistence
- **WebSocket**: Real-time price streams

---

**–í–∞–∂–Ω–æ**: –ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É–µ—Ç —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã fault tolerance –∏ graceful degradation. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö price providers.