# KEMBridge Frontend: Optimized Wallet Integration Setup

## üìã Overview

–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤ –¥–ª—è KEMBridge. –§–æ–∫—É—Å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ user experience –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

## üéØ Architecture Strategy

### Multi-Wallet Support Architecture

**Supported Wallets:**
- **MetaMask**: Primary Ethereum wallet (built-in browser extension)
- **NEAR Wallet**: Native NEAR Protocol wallet
- **WalletConnect v2**: Universal wallet protocol –¥–ª—è mobile wallets
- **Coinbase Wallet**: Additional Ethereum option

### Modular Integration Approach

```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ wallet/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers/          # Wallet provider implementations
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metamask.ts     # MetaMask integration
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ near.ts         # NEAR Wallet integration  
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ walletconnect.ts # WalletConnect v2
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ coinbase.ts     # Coinbase Wallet
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts            # Wallet interfaces
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.ts          # Wallet manager orchestrator
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.ts            # Shared wallet utilities
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ wallet/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useWallet.ts        # Main wallet hook
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useBalance.ts       # Balance management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useTransaction.ts   # Transaction handling
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useNetwork.ts       # Network management
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ wallet/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WalletConnect/      # Wallet connection UI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WalletSelector/     # Wallet selection modal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WalletInfo/         # Connected wallet display
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NetworkSwitcher/    # Network switching UI
```

## üîß Dependencies Strategy

### Minimal Dependency Approach

**Core Dependencies:**
```json
{
  "@near-wallet-selector/core": "^8.9.10",
  "@near-wallet-selector/my-near-wallet": "^8.9.10", 
  "@rainbow-me/rainbowkit": "^2.1.0",
  "wagmi": "^2.12.0",
  "viem": "^2.21.0"
}
```

**Dependency Analysis:**
- **NEAR**: –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π wallet selector (lightweight)
- **Ethereum**: RainbowKit + Wagmi –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **WalletConnect**: –í—Å—Ç—Ä–æ–µ–Ω –≤ RainbowKit (v2 support)
- **NO external UI libraries**: –ü–æ–ª–Ω–æ—Å—Ç—å—é custom UI components

## üèóÔ∏è Implementation Plan

### Phase 7.2.1: Core Wallet Architecture

**Tasks:**
1. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WalletManager orchestrator
3. –î–æ–±–∞–≤–∏—Ç—å error handling –∏ state management
4. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ React hooks

**Dependencies:** ‚úÖ None (–æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ)

### Phase 7.2.2: MetaMask Integration

**Tasks:**
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å MetamaskProvider
2. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ network switching
4. Account change handling

**Dependencies:** ‚úÖ None (–Ω–∞—Ç–∏–≤–Ω–∞—è browser API)

### Phase 7.2.3: NEAR Wallet Integration

**Tasks:**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å NEAR wallet selector
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å NearProvider
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Chain Signatures
4. Account management

**Dependencies:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç backend API –¥–ª—è NEAR operations (Phase 4.2 - ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û)

### Phase 7.2.4: RainbowKit + Wagmi Setup

**Tasks:**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Wagmi client
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RainbowKit providers
3. Custom wallet themes
4. WalletConnect v2 configuration

**Dependencies:** ‚úÖ None (—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

### Phase 7.2.5: Wallet UI Components

**Tasks:**
1. WalletConnect modal —Å custom design
2. WalletInfo display component
3. NetworkSwitcher —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π ETH/NEAR
4. Balance display components

**Dependencies:** ‚úÖ Phase 7.1 (UI components) - ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

### Phase 7.2.6: Authentication Integration

**Tasks:**
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend auth API
2. JWT token management
3. Wallet signature verification
4. Session persistence

**Dependencies:** ‚úÖ Phase 2 (Authentication) - ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

## üîê Security Considerations

### Secure Wallet Handling

**Security Patterns:**
- **Never store private keys**: –¢–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å wallet APIs
- **Signature verification**: Backend –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–µ–π
- **Session management**: Secure JWT handling
- **Network validation**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏

### Error Handling Strategy

**Comprehensive Error Handling:**
```typescript
interface WalletError {
  code: WalletErrorCode;
  message: string;
  details?: any;
}

enum WalletErrorCode {
  WalletNotFound = 'WALLET_NOT_FOUND',
  UserRejected = 'USER_REJECTED', 
  NetworkMismatch = 'NETWORK_MISMATCH',
  InsufficientFunds = 'INSUFFICIENT_FUNDS',
  ConnectionFailed = 'CONNECTION_FAILED'
}
```

## üìä Performance Optimization

### Lazy Loading Strategy

**Bundle Optimization:**
- Lazy load wallet providers
- Dynamic imports –¥–ª—è heavy dependencies
- Code splitting –ø–æ wallet types
- Minimal initial bundle size

### State Management Efficiency

**React State Optimization:**
- –ú–µ–º–æ–∏–∑–∞—Ü–∏—è wallet state
- Selective re-renders
- Efficient balance updates
- Network state caching

## üé® User Experience Design

### Connection Flow UX

**Seamless Connection:**
1. **Auto-detection**: Detect available wallets
2. **Smart defaults**: Remember last used wallet
3. **One-click connect**: Minimize user actions
4. **Clear feedback**: Loading states –∏ error messages

### Visual Design Patterns

**Wallet UI Principles:**
- **Clear wallet status**: Connected/disconnected states
- **Network indicators**: Visual network display
- **Balance visibility**: Prominent balance display
- **Security badges**: Security status indicators

## üîó Backend Integration Points

### API Integration Requirements

**Required Backend Endpoints:**
- `GET /api/v1/auth/nonce` - ‚úÖ Ready (Phase 2.1)
- `POST /api/v1/auth/verify-wallet` - ‚úÖ Ready (Phase 2.1)
- `GET /api/v1/user/profile` - ‚úÖ Ready (Phase 2.3)
- `GET /api/v1/user/wallets` - ‚úÖ Ready (Phase 2.3)

### Real-time Data Integration

**WebSocket Connections:**
- Balance updates
- Transaction status
- Network events
- Security alerts

## üß™ Testing Strategy

### Component Testing

**Testing Approach:**
- Unit tests –¥–ª—è wallet providers
- Integration tests –¥–ª—è hooks
- UI component testing
- Error scenario testing

### Mock Strategy

**Development Mocks:**
```typescript
// TODO (MOCK WARNING): Remove mock data before production
const mockWalletState = {
  isConnected: false,
  address: null,
  balance: '0',
  network: null
};
```

## üìã Implementation Checklist

### ‚úÖ 7.2.1 Core Wallet Architecture
- [ ] Wallet types –∏ interfaces
- [ ] WalletManager implementation
- [ ] Base React hooks
- [ ] Error handling system

### ‚úÖ 7.2.2 MetaMask Integration  
- [ ] MetamaskProvider implementation
- [ ] Auto-connect functionality
- [ ] Network switching
- [ ] Account change handling

### ‚úÖ 7.2.3 NEAR Wallet Integration
- [ ] NEAR wallet selector setup
- [ ] NearProvider implementation  
- [ ] Chain Signatures integration
- [ ] Account management

### ‚úÖ 7.2.4 RainbowKit + Wagmi Setup
- [ ] Wagmi client configuration
- [ ] RainbowKit provider setup
- [ ] Custom theming
- [ ] WalletConnect v2 config

### ‚úÖ 7.2.5 Wallet UI Components
- [ ] WalletConnect modal
- [ ] WalletInfo component
- [ ] NetworkSwitcher component
- [ ] Balance display components

### ‚úÖ 7.2.6 Authentication Integration
- [ ] Backend auth API integration
- [ ] JWT token management
- [ ] Signature verification flow
- [ ] Session persistence

## üéØ Success Metrics

### Technical Achievements
- [ ] **Sub-200ms connection**: –ë—ã—Å—Ç—Ä–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤
- [ ] **Zero wallet deps**: Minimal external dependencies
- [ ] **Multi-wallet support**: All target wallets working
- [ ] **Secure integration**: Proper security patterns

### User Experience
- [ ] **One-click connect**: –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- [ ] **Clear status**: –ü–æ–Ω—è—Ç–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] **Error recovery**: Graceful error handling
- [ ] **Mobile support**: –û—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

---

## üîÑ Next Steps

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 7.2 –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫:

- **7.3 Custom Authentication UI** - UI –¥–ª—è Web3 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **7.4 High-Performance Bridge Interface** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–≤–æ–ø–∞
- **7.5 Custom Security & Risk Display** - UI –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–æ–≤

**Wallet Integration Progress:** 0/6 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (–Ω–∞—á–∏–Ω–∞–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é)